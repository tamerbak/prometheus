<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<ui:composition template="#{frontController.masterPage}">
	<ui:define name="contenu">
		<p:dialog id="dlg2" closable="false" widgetVar="dlg2" modal="false"
			resizable="false" dynamic="false">
			<p:graphicImage value="/images/loading.gif" />
			<p:spacer width="20" height="10" />
			<label style="position: relative; bottom: 10px;">Chargement
				...</label>
		</p:dialog>
		<p:dialog id="cnfdlg" widgetVar="cnfdlg" header="Déconnexion"
			closable="false" modal="false">
			<center>
				Pour que les changements prennent effet vous allez devoir vous
				reconnecter<br /> Etes-vous sûr de vouloir continuer ?
			</center>
			<f:facet name="footer">
				<center>
					<p:commandButton value="Valider"
						action="#{organisationController.chPwd}" onstart="PF('dlg2').show();"
						oncomplete="PF('dlg2').hide();" update="@form"
						styleClass="button glossy float-right login-button" />
					<p:spacer width="15" height="5" />
					<p:commandButton value="Annuler" oncomplete="cnfdlg.hide();"
						update="@form" styleClass="button glossy float-right login-button" />
				</center>
			</f:facet>
		</p:dialog>

		<p:growl id="growl" showDetail="true" sticky="true" />
		<div class="index-center">
			<hgroup id="main-title" class="thin">
			<h1 class="titleH1">Administration</h1>
			</hgroup>
		</div>
		<center>
			<h:panelGrid style="text-align:center" columns="6">
				<h:panelGrid columns="1" style="text-align:center;margin-right:20px">
					<p:commandLink action="protogen-administration">
						<p:graphicImage value="img/adminicon/utilisateur.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-administration" value="Utilisateur" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-right:20px;margin-left:20px">
					<p:commandLink action="parametrage-profils" ajax="false">
						<p:graphicImage value="img/adminicon/roles.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="parametrage-profils" value="Habilitations" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-events">
						<p:graphicImage value="img/adminicon/evenements.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-events" value="Evénements" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-organisation" ajax="false">
						<p:graphicImage value="img/adminicon/organisation.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-organisation" value="Organisation" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-manage-dashboard" ajax="false">
						<p:graphicImage value="img/adminicon/dashboar-manager.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-manage-dashboard" value="Tableau de board" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					
						<p:graphicImage value="assets/img/wiki-article.png" style="height: 70px;cursor:pointer;" onclick="window.open('wiki-ArticleList.xhtml');"/>
					
					<a id="articles_bo_url" style="color: black !important;font-weight:bold"  target="_blank"
						href="wiki-ArticleList.xhtml">Gestion des articles</a>
				</h:panelGrid>
			</h:panelGrid>
		</center>
		<details class="details margin-bottom" open="true"> <summary
			class="summaryDetails">Organisation</summary> 
			<p:panelGrid columns="2" style="width:100%" >
				<h:outputText value="Structure" />
				<p:inputText value="#{organisationController.structure.nom}" style="width:240px" />
			</p:panelGrid>
			<p:spacer width="20" height="20" />
			<p:panelGrid columns="2" style="width:100%" >
				<f:facet name="header">Niveau organisationnel</f:facet>
				<h:outputText value="Organisation" />
				<p:inputText value="#{organisationController.organisation.name}" style="width:240px" />
				<h:outputText value="Type" />
				<p:selectOneMenu value="#{organisationController.roleId}" style="width:230px" >
					<f:selectItems value="#{organisationController.roles}" var="rl"
						itemLabel="#{rl.libelle}" itemValue="#{rl.id}" />
				</p:selectOneMenu>
				<h:outputText value="Représentée par" />
				<p:selectOneMenu value="#{organisationController.entityId}" style="width:230px" >
					<f:selectItems value="#{organisationController.entities}" var="rl"
						itemLabel="#{rl.name}" itemValue="#{rl.id}" />
				</p:selectOneMenu>
				<h:outputText value="Parent" />
				<p:selectOneMenu value="#{organisationController.parentId}" style="width:230px" >
					<f:selectItem itemLabel="" itemValue="0" />
					<f:selectItems value="#{organisationController.organisations}" var="rl"
						itemLabel="#{rl.name}" itemValue="#{rl.id}" />
				</p:selectOneMenu>
				<f:facet name="footer">
					<p:commandButton value="Ajouter" icon="ui-icon-plus" actionListener="#{organisationController.addOrganisation}"
						ajax="false" />
				</f:facet>
			</p:panelGrid>
			<p:spacer width="20" height="20" />
			<p:treeTable value="#{organisationController.organisationsTree}" var="org">
				<p:column headerText="Niveau">
		            <h:outputText value="#{org.nom}" />
		        </p:column>
		        <p:column headerText="Type">
		            <h:outputText value="#{org.type}" />
		        </p:column>
			</p:treeTable>
			<p:spacer width="20" height="20" />
			<p:commandButton value="Enregistrer" actionListener="#{organisationController.saveStructure}" 
				update="@form" />
		</details>
		<details class="details margin-bottom"
			pt:rendered="#{organisationController.superAdmin}" pt:id="adminorg"
			pt:widgetVar="adminorg"> 
			<summary class="summaryDetails">Administration des organisations</summary>
			<p:panelGrid style="width:100%;padding:40px;background:none;border:none !important;" id="neworggrid">
			<p:row>
				<p:column styleClass="column-admin">
					<p:outputLabel for="pkgs" value="Modèles de paramétrage"
						styleClass="outputLabel-custom" />
				</p:column>
				<p:column>

					<p:selectOneMenu id="pkgs" style="width:263px;"
						value="#{organisationController.selectedPkgId}">
						<p:ajax event="change"
							listener="#{organisationController.parameterPkgChange}"
							update="instances" />
						<f:selectItems value="#{organisationController.pkgs}" var="inst"
							itemLabel="#{inst.value}" itemValue="#{inst.key}" />
					</p:selectOneMenu>

				</p:column>
			</p:row>

			<p:row>
				<p:column styleClass="column-admin">
					<p:outputLabel for="instances" value="Configurations"
						styleClass="outputLabel-custom" />
				</p:column>
				<p:column>
					<p:selectCheckboxMenu id="instances"
						value="#{organisationController.selectedInstances}"
						label="Configurations" style="width:263px;">
						<f:selectItems value="#{organisationController.pkinstances}"
							var="inst" itemLabel="#{inst.value}" itemValue="#{inst.key}" />
					</p:selectCheckboxMenu>
				</p:column>
			</p:row>

		</p:panelGrid>

		<table>
			<tr>
				<td></td>
				<td align="right" class="with-padding" style="width: 100%;"><p:commandButton
						value="Ajouter" ajax="false"
						actionListener="#{organisationController.saveParameters}"
						styleClass="button glossy float-right login-button"
						update="adminorg" onstart="PF('dlg2').show();" oncomplete="PF('dlg2').hide();" /></td>
			</tr>
		</table>

		</details>
		<br />

		<details class="details margin-bottom" pt:id="parainst"
			pt:widgetVar="parainst"
			pt:rendered="#{organisationController.superAdmin}"> <summary
			class="summaryDetails">Modèles de paramétrage</summary> <p:panelGrid
			style="width:100%;padding:40px;background:none;border:none !important;"
			id="orgprmgrid">

			<p:row>
				<p:column styleClass="column-admin">
					<p:outputLabel for="ipkgs" value="Modèles de paramétrage"
						styleClass="outputLabel-custom" />
				</p:column>
				<p:column>
					<p:selectOneMenu id="ipkgs"
						value="#{organisationController.iselectedPkgId}">
						<p:ajax event="change"
							listener="#{organisationController.iparameterPkgChange}"
							update="instances" />
						<f:selectItems value="#{organisationController.pkgs}" var="inst"
							itemLabel="#{inst.value}" itemValue="#{inst.key}" />
					</p:selectOneMenu>
				</p:column>
			</p:row>

			<p:row>
				<p:column styleClass="column-admin">
					<p:outputLabel for="iinstances" value="Enregistrements"
						styleClass="outputLabel-custom" />
				</p:column>
				<p:column>
					<p:selectCheckboxMenu id="iinstances"
						value="#{organisationController.selectedRows}"
						label="Configurations">
						<f:selectItems value="#{organisationController.pkgRows}" var="inst"
							itemLabel="#{inst.value}" itemValue="#{inst.key}" />
					</p:selectCheckboxMenu>
				</p:column>
			</p:row>

		</p:panelGrid>

		<table>
			<tr>
				<td></td>
				<td align="right" class="with-padding" style="width: 100%;"><p:commandButton
						value="Enregistrer"
						actionListener="#{organisationController.saveInstanceParameters}"
						ajax="false" styleClass="button glossy float-right login-button" />
				</td>
			</tr>
		</table>

		</details>
		
	</ui:define>
	
</ui:composition>
</html>