<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">


<ui:composition template="#{frontController.masterPage}">
	<ui:define name="contenu">
		<p:growl id="growl" showDetail="true" sticky="true" />
		
		<p:dialog id="dlg2" closable="false" widgetVar="dlg2" modal="false"
			resizable="false" dynamic="false">
			<p:graphicImage value="/images/loading.gif" />
			<p:spacer width="20" height="10" />
			<label style="position: relative; bottom: 10px;">Chargement
				...</label>
		</p:dialog>
		
		<div class="index-center">
			<hgroup id="main-title" class="thin">
			<h1 class="titleH1">Gestion des habilitations</h1>
			</hgroup>
		</div>
<center>
			<h:panelGrid style="text-align:center" columns="6">
				<h:panelGrid columns="1" style="text-align:center;margin-right:20px">
					<p:commandLink action="protogen-administration">
						<p:graphicImage value="img/adminicon/utilisateur.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-administration" value="Utilisateur" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-right:20px;margin-left:20px">
					<p:commandLink action="parametrage-profils" ajax="false">
						<p:graphicImage value="img/adminicon/roles.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="parametrage-profils" value="Habilitations" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-events">
						<p:graphicImage value="img/adminicon/evenements.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-events" value="Evénements" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-organisation" ajax="false">
						<p:graphicImage value="img/adminicon/organisation.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-organisation" value="Organisation" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					<p:commandLink action="protogen-manage-dashboard" ajax="false">
						<p:graphicImage value="img/adminicon/dashboar-manager.png" style="height: 70px;" />
					</p:commandLink>
					<p:commandLink style="color: black !important;font-weight:bold" 
						action="protogen-manage-dashboard" value="Tableau de board" ajax="false" />
				</h:panelGrid>
				<h:panelGrid columns="1" style="text-align:center;margin-left:20px">
					
						<p:graphicImage value="assets/img/wiki-article.png" style="height: 70px;cursor:pointer;" onclick="window.open('wiki-ArticleList.xhtml');"/>
					
					<a id="articles_bo_url" style="color: black !important;font-weight:bold"  target="_blank"
						href="wiki-ArticleList.xhtml">Gestion des articles</a>
				</h:panelGrid>
			</h:panelGrid>
		</center>
		<details class="details margin-bottom" open="true" > 
			<summary class="summaryDetails">Définition du rôle</summary>
			<p:panelGrid columns="2" style="width:100%">
				<h:outputText value="Libellé" />
				<p:inputText value="#{profilControl.role.role}" style="width: 154px;" />
				<h:outputText value="Description" />
				<p:inputTextarea value="#{profilControl.role.description}" cols="28" />
				<h:outputText value="Profil" />
				<p:selectOneMenu value="#{profilControl.selectedProfilId}" style="width:161px" >
					<f:selectItem itemLabel="" itemValue="0"/>
					<f:selectItems value="#{profilControl.profils}" var="prf"
						itemLabel="#{prf.libelle}" itemValue="#{prf.id}" />
				</p:selectOneMenu>
				<h:outputText value="Date de début" />
				<p:calendar locale="#{frontController.localization.langCode}" pattern="#{frontController.localization.dateFormat}" value="#{profilControl.dateDebut}" />
				<h:outputText value="Date de fin" />
				<p:calendar locale="#{frontController.localization.langCode}" pattern="#{frontController.localization.dateFormat}" value="#{profilControl.dateFin}" />
				<h:outputText value="Logo" />
				<p:fileUpload id="idfichier_#{uictrl.attribute.id}"
					locale="#{frontController.localization.langCode}" cancelLabel="Annuler" label="Parcourir"
					uploadLabel="Charger"
					fileUploadListener="#{profilControl.handleFileUpload}"
					update="@form" mode="advanced"
					allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
				<f:facet name="footer">
					<p:commandButton value="Enregistrer" actionListener="#{profilControl.saveRole}" update="@form"
						onstart="PF('dlg2').show();" oncomplete="PF('dlg2').hide();" />
				</f:facet>
			</p:panelGrid>
		</details>
		<details class="details margin-bottom" > 
			<summary class="summaryDetails">Ecrans</summary>
			<p:panelGrid style="width:100%" columns="3">
				<h:outputText value="Ecrans" />
				<p:selectCheckboxMenu label="Ecrans" value="#{profilControl.chosenWindows}" 
					filter="true" filterMatchMode="contains" >
					<p:ajax event="change" listener="#{profilControl.selectedScreensChange}" update="screenList" />
					<f:selectItems value="#{profilControl.allWindows}" var="win" 
						itemLabel="#{win.title}" itemValue="#{win.id}" />
				</p:selectCheckboxMenu>
				
			</p:panelGrid>
			<h:panelGrid columns="3" style="width:100%">
				<p:dataTable id="screenList" widgetVar="screenList"
					value="#{profilControl.windows}" var="win" selectionMode="single"
					selection="#{profilControl.selectedWindow}" rowKey="#{win.id}" >
					<p:ajax event="rowSelect" listener="#{profilControl.onRowSelection}" 
						update="@form" />
					<p:column headerText="Ecran" >
						#{win.title}
					</p:column>
				</p:dataTable>
				<p:spacer width="5" height="5" />
				<p:panelGrid columns="2">
					<h:outputText value="Modification" />
					<p:selectBooleanCheckbox value="#{profilControl.modification}" >
						<p:ajax update="@this" listener="#{profilControl.updateHabil}" />
					</p:selectBooleanCheckbox>
					<h:outputText value="Suppression" />
					<p:selectBooleanCheckbox value="#{profilControl.suppression}" >
						<p:ajax update="@this" listener="#{profilControl.updateHabil}" />
					</p:selectBooleanCheckbox>
					<h:outputText value="Champs" />
					<p:selectCheckboxMenu label="Champs" value="#{profilControl.selAtts}" 
						filter="true" filterMatchMode="contains" >
						<p:ajax event="change" update="@this" 
							listener="#{profilControl.selectedFieldsChange}"/>
						<f:selectItems value="#{profilControl.allAtts}" />
					</p:selectCheckboxMenu>
				</p:panelGrid>
			</h:panelGrid>
		</details>
		<details class="details margin-bottom" >
			<summary class="summaryDetails">Utilisateurs</summary>
			<p:panelGrid
				style="width:100%;padding:40px;background:none;border:none !important;"
				id="newusergrid">

				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="numail" value="E-Mail"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:inputText id="numail"
							value="#{administrationControl.nucreatingUser.login}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nunom" value="Nom"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:inputText id="nunom"
							value="#{administrationControl.nucreatingUser.lastName}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuprenom" value="Prénom"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:inputText id="nuprenom"
							value="#{administrationControl.nucreatingUser.firstName}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuutel" value="Téléphone"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:inputText id="nuutel"
							value="#{administrationControl.nucreatingUser.tel}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuadrss" value="Adresse"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:inputTextarea id="nuadrss"
							value="#{administrationControl.nucreatingUser.adress}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuthm" value="Thème visuel"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nuthm"
							value="#{administrationControl.nuselectedTheme}"
							style="width:263px;">
							<f:selectItem itemLabel="DEVELOPR" itemValue="THEME:DEVELOPR" />
							<f:selectItem itemLabel="Thème bleu" itemValue="THEME:BLEU" />
							<f:selectItem itemLabel="Thème rouge" itemValue="THEME:ROUGE" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuprofil" value="Profil utilisateur"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nuroleprofil"
							value="#{administrationControl.selectedProfilId}"
							style="width:263px;">
							<p:ajax event="change"
								listener="#{administrationControl.selectedProfileChanged}"
								update="nuprofil" onstart="PF('dlg2').show();" oncomplete="PF('dlg2').hide();" />
							<f:selectItem itemLabel="" itemValue="0" />
							<f:selectItems value="#{administrationControl.profils}"
								var="prfl" itemLabel="#{prfl.libelle}" itemValue="#{prfl.id}" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuprofil" value="Rôle utilisateur"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nuprofil"
							value="#{administrationControl.nuselectedProfil}"
							style="width:263px;">
							<p:ajax event="change"
								listener="#{administrationControl.profileChanged}"
								update="nubound" onstart="PF('dlg2').show();" oncomplete="PF('dlg2').hide();" />
							<f:selectItems value="#{administrationControl.nuprofiles}"
								var="prfl" itemLabel="#{prfl.role}" itemValue="#{prfl.id}" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuorganization" value="Organisation"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nuorganization"
							value="#{administrationControl.nuselectedOrg}"
							style="width:263px;">
							<f:selectItems value="#{administrationControl.organizations}"
								var="org" itemLabel="#{org.value}" itemValue="#{org.key}" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nuentity" value="Affectation"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nuentity"
							value="#{administrationControl.nuselectedOrgInstance}"
							style="width:263px;">
							<f:selectItems value="#{administrationControl.instances}"
								var="org" itemLabel="#{org.value}" itemValue="#{org.key}" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nubound" value="Entité"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:selectOneMenu id="nubound"
							value="#{administrationControl.nuselectedEntity}"
							style="width:263px;">
							<f:selectItem itemLabel="Faites votre choix" itemValue="0" />
							<f:selectItems value="#{administrationControl.entities}" var="org"
								itemLabel="#{org.value}" itemValue="#{org.key}" />
						</p:selectOneMenu>
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nunewpwd" value="Nouveau mot de passe"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:password id="nunewpwd"
							value="#{administrationControl.nunewPassword}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
				<p:row>
					<p:column styleClass="column-admin">
						<p:outputLabel for="nucpwd" value="Confirmation"
							styleClass="outputLabel-custom" />
					</p:column>
					<p:column>
						<p:password id="nucpwd"
							value="#{administrationControl.nuconfirmPassword}"
							styleClass="input input-width-2" />
					</p:column>
				</p:row>
	
			</p:panelGrid>
	
			<table>
				<tr>
					<td></td>
					<td align="right" class="with-padding" style="width: 100%;"><p:commandButton
							value="Ajouter"
							actionListener="#{administrationControl.createUserInstance}"
							update="@form" onstart="PF('dlg2').show();" oncomplete="PF('dlg2').hide();"
							styleClass="button glossy float-right login-button" /></td>
				</tr>
			</table>
		</details>
	</ui:define>	
</ui:composition>
</html>